/*
 * motor_driver.c
 *
 *  Created on: Apr 17, 2025
 *      Author: kyle
 */

#include "motor_driver.h"

void motor_set(motor* m, uint32_t duty_cycle, int8_t direction) {
	if (duty_cycle > 100) duty_cycle = 100;

	m->duty_cycle = duty_cycle;
	m->direction = direction;

	uint32_t pulse = (__HAL_TIM_GET_AUTORELOAD(m->htim) + 1) * duty_cycle;

	__HAL_TIM_SET_COMPARE(m->htim, m->pwm_channel1, pulse);
}

void motor_enable(motor* m) {
	HAL_TIM_PWM_Start_IT(&m->htim, TIM_CHANNEL_1);
	HAL_TIM_PWM_Start_IT(&m->htim, TIM_CHANNEL_2);
}
